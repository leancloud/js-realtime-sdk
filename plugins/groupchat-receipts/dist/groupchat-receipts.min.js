!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],t):t((e=e||self).AV=e.AV||{},e.AV)}(this,(function(e,t){"use strict";var n=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var o=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){!function(t){var n=function(){},r=Object.prototype.hasOwnProperty,o=Object.create||function(e){var t=function(){};return t.prototype=e,new t},a=Object.keys||function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(n);return t},s=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e},i=Object.setPrototypeOf||s,u=Object.prototype.toString,c=Array.isArray||function(e){return"[object Array]"===u.call(e)},p=function(e){return"[object Function]"===u.call(e)},l=!0,f={toString:""};for(var d in f)f.hasOwnProperty(d)&&(l=!1);var m=l?["toString","valueOf"]:null;function y(e,t,r){for(var o,s,i=function(e){var t=a(e);if(l)for(var n,r=0;n=m[r++];)e.hasOwnProperty(n)&&t.push(n);return t}(r),u=0,c=i.length;u<c;)"__self"!==(o=i[u++])&&(s=r[o],p(s)&&(!s.prototype||!s.prototype.__self)&&s.toString().indexOf(".__base")>-1?t[o]=function(r,o){var a=e[r]?e[r]:"__constructor"===r?t.__self.__parent:n,s=function(){var e=this.__base;this.__base=s.__base;var t=o.apply(this,arguments);return this.__base=e,t};return s.__base=a,s}(o,s):t[o]=s)}function _(e,t){for(var n,r=1;n=e[r++];)t?p(n)?h.self(t,n.prototype,n):h.self(t,n):t=p(n)?h(e[0],n.prototype,n):h(e[0],n);return t||e[0]}function h(){var e=arguments,t=c(e[0]),r=t||p(e[0]),a=r?t?_(e[0]):e[0]:n,u=e[r?1:0]||{},l=e[r?2:1],f=u.__constructor||r&&a.prototype&&a.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:r?function(){return a.apply(this,arguments)}:function(){};if(!r)return f.prototype=u,f.prototype.__self=f.prototype.constructor=f,s(f,l);i(f,a),f.__parent=a;var d=a.prototype,m=f.prototype=o(d);return m.__self=m.constructor=f,u&&y(d,m,u),l&&y(a,f,l),f}h.self=function(){var e=arguments,t=c(e[0]),n=t?_(e[0],e[0][0]):e[0],r=e[1],o=e[2],a=n.prototype;return r&&y(a,a,r),o&&y(n,n,o),n};var g=!0;e.exports=h,g=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",(function(e){e(h)})),g=!1),g&&(t.inherit=h)}(r)}));
/*!
   * node-inherit
   * Copyright(c) 2011 Dmitry Filatov <dfilatov@yandex-team.ru>
   * MIT Licensed
   */if(!t.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var a=o(t.TypedMessage,{__constructor:function(e){this.__base(),this.timestamp=new Date(e)}});t.messageType(-101)(a),t.messageField(["timestamp"])(a),a.sendOptions={transient:!0};var s={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[a],onIMClientCreate:function(e){var t=e._sendReadCommand;e._sendReadCommand=function(n){n.forEach((function(e){!e.transient&&e.members.length>2&&e.send(new a(e.lastMessageAt||new Date)).catch((function(e){return console.warn("Sending groupchat receipt fail: ".concat(e.message))}))}));for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return t.call.apply(t,[e,n].concat(o))}},onConversationCreate:function(e){var t=e.queryMessages;e.queryMessages=function(){!e.transient&&e.members.length>2&&!e.lastReadTimestamps&&e._fetchAllReceiptTimestamps().then((function(t){e.lastReadTimestamps=t.reduce((function(e,t){var r=t.pid,o=t.lastReadAt;return Object.assign(e,n({},r,o))}),{}),e.emit("lastreadtimestampsupdate",e.lastReadTimestamps)})).catch((function(e){return console.warn("Initialize group receipts fail: ".concat(e.message))}));for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return t.call.apply(t,[e].concat(o))}},beforeMessageDispatch:function(e,t){return e.type!==a.TYPE||(t.lastReadTimestamps&&(t.lastReadTimestamps[e.from]=e.timestamp,t.emit("lastreadtimestampsupdate",n({},e.from,e.timestamp))),!1)}};e.GroupchatReceiptsPlugin=s,e.ReadReceipt=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=groupchat-receipts.min.js.map
