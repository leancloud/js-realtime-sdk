{"version":3,"file":"groupchat-receipts.js","sources":["../../../node_modules/@babel/runtime/helpers/defineProperty.js","../../../node_modules/inherit/lib/inherit.js","../../../node_modules/inherit/index.js","../src/realtime.js","../src/read-receipt.js","../src/index.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","/**\n * @module inherit\n * @version 2.2.7\n * @author Filatov Dmitry <dfilatov@yandex-team.ru>\n * @description This module provides some syntax sugar for \"class\" declarations, constructors, mixins, \"super\" calls and static members.\n */\n\n(function(global) {\n\nvar noop = function() {},\n    hasOwnProperty = Object.prototype.hasOwnProperty,\n    objCreate = Object.create || function(ptp) {\n        var inheritance = function() {};\n        inheritance.prototype = ptp;\n        return new inheritance();\n    },\n    objKeys = Object.keys || function(obj) {\n        var res = [];\n        for(var i in obj) {\n            hasOwnProperty.call(obj, i) && res.push(i);\n        }\n        return res;\n    },\n    extend = function(o1, o2) {\n        for(var i in o2) {\n            hasOwnProperty.call(o2, i) && (o1[i] = o2[i]);\n        }\n\n        return o1;\n    },\n    extendStatic = Object.setPrototypeOf || extend,\n    toStr = Object.prototype.toString,\n    isArray = Array.isArray || function(obj) {\n        return toStr.call(obj) === '[object Array]';\n    },\n    isFunction = function(obj) {\n        return toStr.call(obj) === '[object Function]';\n    },\n    needCheckProps = true,\n    testPropObj = { toString : '' };\n\nfor(var i in testPropObj) { // It's a pity ie hasn't toString, valueOf in for\n    testPropObj.hasOwnProperty(i) && (needCheckProps = false);\n}\n\nvar specProps = needCheckProps? ['toString', 'valueOf'] : null;\n\nfunction getPropList(obj) {\n    var res = objKeys(obj);\n    if(needCheckProps) {\n        var specProp, i = 0;\n        while(specProp = specProps[i++]) {\n            obj.hasOwnProperty(specProp) && res.push(specProp);\n        }\n    }\n\n    return res;\n}\n\nfunction override(base, res, add) {\n    var addList = getPropList(add),\n        j = 0, len = addList.length,\n        name, prop;\n    while(j < len) {\n        if((name = addList[j++]) === '__self') {\n            continue;\n        }\n        prop = add[name];\n        if(isFunction(prop) &&\n                (!prop.prototype || !prop.prototype.__self) && // check to prevent wrapping of \"class\" functions\n                (prop.toString().indexOf('.__base') > -1)) {\n            res[name] = (function(name, prop) {\n                var baseMethod = base[name]?\n                        base[name] :\n                        name === '__constructor'? // case of inheritance from plain function\n                            res.__self.__parent :\n                            noop,\n                    result = function() {\n                        var baseSaved = this.__base;\n\n                        this.__base = result.__base;\n                        var res = prop.apply(this, arguments);\n                        this.__base = baseSaved;\n\n                        return res;\n                    };\n                result.__base = baseMethod;\n\n                return result;\n            })(name, prop);\n        } else {\n            res[name] = prop;\n        }\n    }\n}\n\nfunction applyMixins(mixins, res) {\n    var i = 1, mixin;\n    while(mixin = mixins[i++]) {\n        res?\n            isFunction(mixin)?\n                inherit.self(res, mixin.prototype, mixin) :\n                inherit.self(res, mixin) :\n            res = isFunction(mixin)?\n                inherit(mixins[0], mixin.prototype, mixin) :\n                inherit(mixins[0], mixin);\n    }\n    return res || mixins[0];\n}\n\n/**\n* Creates class\n* @exports\n* @param {Function|Array} [baseClass|baseClassAndMixins] class (or class and mixins) to inherit from\n* @param {Object} prototypeFields\n* @param {Object} [staticFields]\n* @returns {Function} class\n*/\nfunction inherit() {\n    var args = arguments,\n        withMixins = isArray(args[0]),\n        hasBase = withMixins || isFunction(args[0]),\n        base = hasBase? withMixins? applyMixins(args[0]) : args[0] : noop,\n        props = args[hasBase? 1 : 0] || {},\n        staticProps = args[hasBase? 2 : 1],\n        res = props.__constructor || (hasBase && base.prototype && base.prototype.__constructor)?\n            function() {\n                return this.__constructor.apply(this, arguments);\n            } :\n            hasBase?\n                function() {\n                    return base.apply(this, arguments);\n                } :\n                function() {};\n\n    if(!hasBase) {\n        res.prototype = props;\n        res.prototype.__self = res.prototype.constructor = res;\n        return extend(res, staticProps);\n    }\n\n    extendStatic(res, base);\n\n    res.__parent = base;\n\n    var basePtp = base.prototype,\n        resPtp = res.prototype = objCreate(basePtp);\n\n    resPtp.__self = resPtp.constructor = res;\n\n    props && override(basePtp, resPtp, props);\n    staticProps && override(base, res, staticProps);\n\n    return res;\n}\n\ninherit.self = function() {\n    var args = arguments,\n        withMixins = isArray(args[0]),\n        base = withMixins? applyMixins(args[0], args[0][0]) : args[0],\n        props = args[1],\n        staticProps = args[2],\n        basePtp = base.prototype;\n\n    props && override(basePtp, basePtp, props);\n    staticProps && override(base, base, staticProps);\n\n    return base;\n};\n\nvar defineAsGlobal = true;\n/* istanbul ignore next */\nif(typeof exports === 'object') {\n    module.exports = inherit;\n    defineAsGlobal = false;\n}\n/* istanbul ignore next */\nif(typeof modules === 'object' && typeof modules.define === 'function') {\n    modules.define('inherit', function(provide) {\n        provide(inherit);\n    });\n    defineAsGlobal = false;\n}\n/* istanbul ignore next */\nif(typeof define === 'function') {\n    define(function(require, exports, module) {\n        module.exports = inherit;\n    });\n    defineAsGlobal = false;\n}\n/* istanbul ignore next */\ndefineAsGlobal && (global.inherit = inherit);\n\n})(this);\n","/*!\n * node-inherit\n * Copyright(c) 2011 Dmitry Filatov <dfilatov@yandex-team.ru>\n * MIT Licensed\n */\n\nmodule.exports = require('./lib/inherit');\n","/* eslint-disable import/no-unresolved */\nimport { TypedMessage } from 'leancloud-realtime';\n\nif (!TypedMessage) {\n  throw new Error('LeanCloud Realtime SDK not installed');\n}\n\nexport { TypedMessage, messageType, messageField } from 'leancloud-realtime';\n","import inherit from 'inherit';\nimport { messageType, messageField, TypedMessage } from './realtime';\n\nconst ReadReceipt = inherit(TypedMessage, {\n  __constructor(timestamp) {\n    this.__base();\n    this.timestamp = new Date(timestamp);\n  },\n});\nmessageType(-101)(ReadReceipt);\nmessageField(['timestamp'])(ReadReceipt);\nReadReceipt.sendOptions = {\n  transient: true,\n};\n\nexport default ReadReceipt;\n","/** @module leancloud-realtime-plugin-groupchat-receipts */\n\nimport ReadReceipt from './read-receipt';\nimport { name } from '../package.json';\n\n/**\n * @typedef {Object.<String, Date>} GroupchatLastReadTimestamps 对话成员 ID - 最后已读消息时间\n */\n\n/**\n * 群聊已读状态插件。\n * 使用后多人 Conversation 会增加 lastReadTimestamps 属性，该属性是 对话成员 ID - 最后已读消息时间 的键值对。\n * 在首次查询该会话的消息记录后，lastReadTimestamps 将会得到初始值，\n * 之后在该属性有变化时 Conversation 会派发 lastreadtimestampsupdate 事件。\n * @example\n * var realtime = new Realtime({\n *   appId: appId,\n *   appKey: appKey,\n *   server: server,\n *   plugins: [GroupchatReceiptsPlugin],\n * });\n */\nexport const GroupchatReceiptsPlugin = {\n  name,\n  messageClasses: [ReadReceipt],\n  onIMClientCreate: client => {\n    const originalSendReadCommand = client._sendReadCommand;\n    // eslint-disable-next-line no-param-reassign\n    client._sendReadCommand = (conversations, ...args) => {\n      conversations.forEach(conversation => {\n        if (!conversation.transient && conversation.members.length > 2) {\n          conversation\n            .send(new ReadReceipt(conversation.lastMessageAt || new Date()))\n            .catch(error =>\n              console.warn(`Sending groupchat receipt fail: ${error.message}`)\n            );\n        }\n      });\n      return originalSendReadCommand.call(client, conversations, ...args);\n    };\n  },\n  onConversationCreate: conversation => {\n    const originalQueryMessages = conversation.queryMessages;\n    // eslint-disable-next-line no-param-reassign\n    conversation.queryMessages = (...args) => {\n      if (\n        !conversation.transient &&\n        conversation.members.length > 2 &&\n        !conversation.lastReadTimestamps\n      ) {\n        conversation\n          ._fetchAllReceiptTimestamps()\n          .then(maxReadTuple => {\n            // eslint-disable-next-line no-param-reassign\n            conversation.lastReadTimestamps = maxReadTuple.reduce(\n              (result, { pid, lastReadAt }) =>\n                Object.assign(result, { [pid]: lastReadAt }),\n              {}\n            );\n            conversation.emit(\n              'lastreadtimestampsupdate',\n              conversation.lastReadTimestamps\n            );\n          })\n          .catch(error =>\n            console.warn(`Initialize group receipts fail: ${error.message}`)\n          );\n      }\n      return originalQueryMessages.call(conversation, ...args);\n    };\n  },\n  beforeMessageDispatch: (message, conversation) => {\n    if (message.type === ReadReceipt.TYPE) {\n      if (conversation.lastReadTimestamps) {\n        // eslint-disable-next-line no-param-reassign\n        conversation.lastReadTimestamps[message.from] = message.timestamp;\n        /**\n         * 群聊的已读状态更新，由 Conversation 派发\n         * @event lastreadtimestampsupdate\n         * @param {GroupchatLastReadTimestamps} updatedTimestamps 有更新的成员的最后已读消息时间\n         */\n        conversation.emit('lastreadtimestampsupdate', {\n          [message.from]: message.timestamp,\n        });\n      }\n      return false;\n    }\n    return true;\n  },\n};\n\nexport { ReadReceipt };\n"],"names":["this","require$$0","TypedMessage","Error","ReadReceipt","inherit","__constructor","timestamp","__base","Date","messageType","messageField","sendOptions","GroupchatReceiptsPlugin","name","messageClasses","onIMClientCreate","client","originalSendReadCommand","_sendReadCommand","conversations","forEach","conversation","members","length","send","lastMessageAt","error","console","warn","message","args","call","onConversationCreate","originalQueryMessages","queryMessages","lastReadTimestamps","_fetchAllReceiptTimestamps","then","maxReadTuple","reduce","result","pid","lastReadAt","Object","assign","emit","beforeMessageDispatch","type","TYPE","from"],"mappings":"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"}