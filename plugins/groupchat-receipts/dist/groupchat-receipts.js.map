{"version":3,"file":"groupchat-receipts.js","sources":["../../../node_modules/@babel/runtime/helpers/typeof.js","../../../node_modules/@babel/runtime/helpers/toPrimitive.js","../../../node_modules/@babel/runtime/helpers/toPropertyKey.js","../../../node_modules/@babel/runtime/helpers/defineProperty.js","../../../node_modules/inherit/lib/inherit.js","../../../node_modules/inherit/index.js","../src/realtime.js","../src/read-receipt.js","../src/index.js"],"sourcesContent":["function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(obj);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nmodule.exports = _toPrimitive, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar toPrimitive = require(\"./toPrimitive.js\");\nfunction _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nmodule.exports = _toPropertyKey, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/**\n * @module inherit\n * @version 2.2.7\n * @author Filatov Dmitry <dfilatov@yandex-team.ru>\n * @description This module provides some syntax sugar for \"class\" declarations, constructors, mixins, \"super\" calls and static members.\n */\n\n(function(global) {\n\nvar noop = function() {},\n    hasOwnProperty = Object.prototype.hasOwnProperty,\n    objCreate = Object.create || function(ptp) {\n        var inheritance = function() {};\n        inheritance.prototype = ptp;\n        return new inheritance();\n    },\n    objKeys = Object.keys || function(obj) {\n        var res = [];\n        for(var i in obj) {\n            hasOwnProperty.call(obj, i) && res.push(i);\n        }\n        return res;\n    },\n    extend = function(o1, o2) {\n        for(var i in o2) {\n            hasOwnProperty.call(o2, i) && (o1[i] = o2[i]);\n        }\n\n        return o1;\n    },\n    extendStatic = Object.setPrototypeOf || extend,\n    toStr = Object.prototype.toString,\n    isArray = Array.isArray || function(obj) {\n        return toStr.call(obj) === '[object Array]';\n    },\n    isFunction = function(obj) {\n        return toStr.call(obj) === '[object Function]';\n    },\n    needCheckProps = true,\n    testPropObj = { toString : '' };\n\nfor(var i in testPropObj) { // It's a pity ie hasn't toString, valueOf in for\n    testPropObj.hasOwnProperty(i) && (needCheckProps = false);\n}\n\nvar specProps = needCheckProps? ['toString', 'valueOf'] : null;\n\nfunction getPropList(obj) {\n    var res = objKeys(obj);\n    if(needCheckProps) {\n        var specProp, i = 0;\n        while(specProp = specProps[i++]) {\n            obj.hasOwnProperty(specProp) && res.push(specProp);\n        }\n    }\n\n    return res;\n}\n\nfunction override(base, res, add) {\n    var addList = getPropList(add),\n        j = 0, len = addList.length,\n        name, prop;\n    while(j < len) {\n        if((name = addList[j++]) === '__self') {\n            continue;\n        }\n        prop = add[name];\n        if(isFunction(prop) &&\n                (!prop.prototype || !prop.prototype.__self) && // check to prevent wrapping of \"class\" functions\n                (prop.toString().indexOf('.__base') > -1)) {\n            res[name] = (function(name, prop) {\n                var baseMethod = base[name]?\n                        base[name] :\n                        name === '__constructor'? // case of inheritance from plain function\n                            res.__self.__parent :\n                            noop,\n                    result = function() {\n                        var baseSaved = this.__base;\n\n                        this.__base = result.__base;\n                        var res = prop.apply(this, arguments);\n                        this.__base = baseSaved;\n\n                        return res;\n                    };\n                result.__base = baseMethod;\n\n                return result;\n            })(name, prop);\n        } else {\n            res[name] = prop;\n        }\n    }\n}\n\nfunction applyMixins(mixins, res) {\n    var i = 1, mixin;\n    while(mixin = mixins[i++]) {\n        res?\n            isFunction(mixin)?\n                inherit.self(res, mixin.prototype, mixin) :\n                inherit.self(res, mixin) :\n            res = isFunction(mixin)?\n                inherit(mixins[0], mixin.prototype, mixin) :\n                inherit(mixins[0], mixin);\n    }\n    return res || mixins[0];\n}\n\n/**\n* Creates class\n* @exports\n* @param {Function|Array} [baseClass|baseClassAndMixins] class (or class and mixins) to inherit from\n* @param {Object} prototypeFields\n* @param {Object} [staticFields]\n* @returns {Function} class\n*/\nfunction inherit() {\n    var args = arguments,\n        withMixins = isArray(args[0]),\n        hasBase = withMixins || isFunction(args[0]),\n        base = hasBase? withMixins? applyMixins(args[0]) : args[0] : noop,\n        props = args[hasBase? 1 : 0] || {},\n        staticProps = args[hasBase? 2 : 1],\n        res = props.__constructor || (hasBase && base.prototype && base.prototype.__constructor)?\n            function() {\n                return this.__constructor.apply(this, arguments);\n            } :\n            hasBase?\n                function() {\n                    return base.apply(this, arguments);\n                } :\n                function() {};\n\n    if(!hasBase) {\n        res.prototype = props;\n        res.prototype.__self = res.prototype.constructor = res;\n        return extend(res, staticProps);\n    }\n\n    extendStatic(res, base);\n\n    res.__parent = base;\n\n    var basePtp = base.prototype,\n        resPtp = res.prototype = objCreate(basePtp);\n\n    resPtp.__self = resPtp.constructor = res;\n\n    props && override(basePtp, resPtp, props);\n    staticProps && override(base, res, staticProps);\n\n    return res;\n}\n\ninherit.self = function() {\n    var args = arguments,\n        withMixins = isArray(args[0]),\n        base = withMixins? applyMixins(args[0], args[0][0]) : args[0],\n        props = args[1],\n        staticProps = args[2],\n        basePtp = base.prototype;\n\n    props && override(basePtp, basePtp, props);\n    staticProps && override(base, base, staticProps);\n\n    return base;\n};\n\nvar defineAsGlobal = true;\n/* istanbul ignore next */\nif(typeof exports === 'object') {\n    module.exports = inherit;\n    defineAsGlobal = false;\n}\n/* istanbul ignore next */\nif(typeof modules === 'object' && typeof modules.define === 'function') {\n    modules.define('inherit', function(provide) {\n        provide(inherit);\n    });\n    defineAsGlobal = false;\n}\n/* istanbul ignore next */\nif(typeof define === 'function') {\n    define(function(require, exports, module) {\n        module.exports = inherit;\n    });\n    defineAsGlobal = false;\n}\n/* istanbul ignore next */\ndefineAsGlobal && (global.inherit = inherit);\n\n})(this);\n","/*!\n * node-inherit\n * Copyright(c) 2011 Dmitry Filatov <dfilatov@yandex-team.ru>\n * MIT Licensed\n */\n\nmodule.exports = require('./lib/inherit');\n","/* eslint-disable import/no-unresolved */\nimport { TypedMessage } from 'leancloud-realtime';\n\nif (!TypedMessage) {\n  throw new Error('LeanCloud Realtime SDK not installed');\n}\n\nexport { TypedMessage, messageType, messageField } from 'leancloud-realtime';\n","import inherit from 'inherit';\nimport { messageType, messageField, TypedMessage } from './realtime';\n\nconst ReadReceipt = inherit(TypedMessage, {\n  __constructor(timestamp) {\n    this.__base();\n    this.timestamp = new Date(timestamp);\n  },\n});\nmessageType(-101)(ReadReceipt);\nmessageField(['timestamp'])(ReadReceipt);\nReadReceipt.sendOptions = {\n  transient: true,\n};\n\nexport default ReadReceipt;\n","/** @module leancloud-realtime-plugin-groupchat-receipts */\n\nimport ReadReceipt from './read-receipt';\nimport { name } from '../package.json';\n\n/**\n * @typedef {Object.<String, Date>} GroupchatLastReadTimestamps 对话成员 ID - 最后已读消息时间\n */\n\n/**\n * 群聊已读状态插件。\n * 使用后多人 Conversation 会增加 lastReadTimestamps 属性，该属性是 对话成员 ID - 最后已读消息时间 的键值对。\n * 在首次查询该会话的消息记录后，lastReadTimestamps 将会得到初始值，\n * 之后在该属性有变化时 Conversation 会派发 lastreadtimestampsupdate 事件。\n * @example\n * var realtime = new Realtime({\n *   appId: appId,\n *   appKey: appKey,\n *   server: server,\n *   plugins: [GroupchatReceiptsPlugin],\n * });\n */\nexport const GroupchatReceiptsPlugin = {\n  name,\n  messageClasses: [ReadReceipt],\n  onIMClientCreate: client => {\n    const originalSendReadCommand = client._sendReadCommand;\n    // eslint-disable-next-line no-param-reassign\n    client._sendReadCommand = (conversations, ...args) => {\n      conversations.forEach(conversation => {\n        if (!conversation.transient && conversation.members.length > 2) {\n          conversation\n            .send(new ReadReceipt(conversation.lastMessageAt || new Date()))\n            .catch(error =>\n              console.warn(`Sending groupchat receipt fail: ${error.message}`)\n            );\n        }\n      });\n      return originalSendReadCommand.call(client, conversations, ...args);\n    };\n  },\n  onConversationCreate: conversation => {\n    const originalQueryMessages = conversation.queryMessages;\n    // eslint-disable-next-line no-param-reassign\n    conversation.queryMessages = (...args) => {\n      if (\n        !conversation.transient &&\n        conversation.members.length > 2 &&\n        !conversation.lastReadTimestamps\n      ) {\n        conversation\n          ._fetchAllReceiptTimestamps()\n          .then(maxReadTuple => {\n            // eslint-disable-next-line no-param-reassign\n            conversation.lastReadTimestamps = maxReadTuple.reduce(\n              (result, { pid, lastReadAt }) =>\n                Object.assign(result, { [pid]: lastReadAt }),\n              {}\n            );\n            conversation.emit(\n              'lastreadtimestampsupdate',\n              conversation.lastReadTimestamps\n            );\n          })\n          .catch(error =>\n            console.warn(`Initialize group receipts fail: ${error.message}`)\n          );\n      }\n      return originalQueryMessages.call(conversation, ...args);\n    };\n  },\n  beforeMessageDispatch: (message, conversation) => {\n    if (message.type === ReadReceipt.TYPE) {\n      if (conversation.lastReadTimestamps) {\n        // eslint-disable-next-line no-param-reassign\n        conversation.lastReadTimestamps[message.from] = message.timestamp;\n        /**\n         * 群聊的已读状态更新，由 Conversation 派发\n         * @event lastreadtimestampsupdate\n         * @param {GroupchatLastReadTimestamps} updatedTimestamps 有更新的成员的最后已读消息时间\n         */\n        conversation.emit('lastreadtimestampsupdate', {\n          [message.from]: message.timestamp,\n        });\n      }\n      return false;\n    }\n    return true;\n  },\n};\n\nexport { ReadReceipt };\n"],"names":["require$$0","this","TypedMessage","Error","ReadReceipt","inherit","__constructor","timestamp","__base","Date","messageType","messageField","sendOptions","GroupchatReceiptsPlugin","name","messageClasses","onIMClientCreate","client","originalSendReadCommand","_sendReadCommand","conversations","forEach","conversation","members","length","send","lastMessageAt","error","console","warn","concat","message","_len","arguments","args","Array","_key","call","apply","onConversationCreate","originalQueryMessages","queryMessages","lastReadTimestamps","_fetchAllReceiptTimestamps","then","maxReadTuple","reduce","result","_ref","pid","lastReadAt","Object","assign","_defineProperty","emit","_len2","_key2","beforeMessageDispatch","type","TYPE","from"],"mappings":"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"}