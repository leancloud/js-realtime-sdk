{"version":3,"file":"typed-messages.min.js","sources":["../../../node_modules/@babel/runtime/helpers/defineProperty.js","../../../node_modules/@babel/runtime/helpers/createClass.js","../../../node_modules/@babel/runtime/helpers/inheritsLoose.js","../src/index.js","../src/file-message.js","../src/image-message.js","../src/audio-message.js","../src/video-message.js","../src/location-message.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}\n\nmodule.exports = _inheritsLoose;","/* global window */\n\n/** @module leancloud-realtime-plugin-typed-messages */\n\nimport createFileMessageClass from './file-message';\nimport createImageMessageClass from './image-message';\nimport createAudioMessageClass from './audio-message';\nimport createVideoMessageClass from './video-message';\nimport createLocationMessageClass from './location-message';\nimport { name } from '../package.json';\n\n/**\n * 初始化 TypedMessages 插件，使用后可支持接收 LeanCloud 提供的富媒体类型的消息\n * @example\n * const { TypedMessagesPlugin } = initPlugin(AV, Rtm);\n * const realtime = new Realtime({\n *   appId: appId,\n *   appKey: appKey,\n *   server: server,\n *   plugins: TypedMessagesPlugin,\n * });\n */\nexport default function initPlugin(AV, IM) {\n  /**\n   * @see FileMessage\n   */\n  const FileMessage = createFileMessageClass({ AV, IM });\n  /**\n   * @see ImageMessage\n   */\n  const ImageMessage = createImageMessageClass({ FileMessage, IM });\n  /**\n   * @see AudioMessage\n   */\n  const AudioMessage = createAudioMessageClass({ FileMessage, IM });\n  /**\n   * @see VideoMessage\n   */\n  const VideoMessage = createVideoMessageClass({ FileMessage, IM });\n  /**\n   * @see LocationMessage\n   */\n  const LocationMessage = createLocationMessageClass({ AV, IM });\n\n  const TypedMessagesPlugin = {\n    name,\n    messageClasses: [\n      FileMessage,\n      ImageMessage,\n      AudioMessage,\n      VideoMessage,\n      LocationMessage,\n    ],\n  };\n\n  return {\n    TypedMessagesPlugin,\n    FileMessage,\n    ImageMessage,\n    AudioMessage,\n    VideoMessage,\n    LocationMessage,\n  };\n}\n\n// 浏览器环境下自动初始化\nif (typeof window !== 'undefined' && window.AV) {\n  Object.assign(window.AV, initPlugin(window.AV, window.AV));\n}\n","export default function createFileMessageClass({ AV, IM }) {\n  class FileMessage extends IM.TypedMessage {\n    /**\n     * @extends TypedMessage\n     * @param  {AV.File} file LeanCloud 存储 SDK 中的 AV.File 实例，且必须是已经保存到服务端上的 File 实例\n     * （如果是刚刚创建的，必须 save 后才能用于创建 FileMessage）\n     */\n    constructor(file) {\n      if (!(file instanceof AV.File)) {\n        throw new TypeError('file must be an AV.File');\n      }\n      if (typeof file.id !== 'string') {\n        throw new Error('file must be saved before used to create a Message');\n      }\n      super();\n      this._file = file;\n      this._lcfile = {\n        objId: file.id,\n        url: file.url(),\n        metaData: Object.assign(file.metaData() || {}, {\n          name: file.name(),\n        }),\n      };\n    }\n\n    /**\n     * 在客户端需要以文本形式展示该消息时显示的文案，格式为 <code>[类型] file.name()</code>\n     * @type {String}\n     * @readonly\n     */\n    get summary() {\n      return `[${this.constructor._summaryType}] ${this._file.name() ||\n        ''}`.trim();\n    }\n\n    /**\n     * 获得 file 对象\n     * @return {AV.File}\n     */\n    getFile() {\n      return this._file;\n    }\n\n    toJSON() {\n      return {\n        ...super.toJSON(),\n        file: this.getFile().toJSON(),\n      };\n    }\n\n    static _parseFileFromRawData(data) {\n      if (!(data && data._lcfile)) {\n        throw new Error('malformed FileMessage content');\n      }\n      let id = data._lcfile.objId;\n      if (typeof id !== 'string') {\n        id = '';\n      }\n      const file = AV.File.createWithoutData(id);\n      file.attributes = file.attributes || {};\n      file._url = data._lcfile.url;\n      file.attributes.url = file._url;\n      file._metaData = data._lcfile.metaData || {};\n      file.attributes.metaData = file._metaData;\n      if (data._lcfile.metaData) {\n        file._name = data._lcfile.metaData.name;\n        file.attributes.name = file._name;\n      }\n      return file;\n    }\n\n    static parse(json, message) {\n      const file = this._parseFileFromRawData(json);\n      return IM.TypedMessage.parse(json, message || new this(file));\n    }\n  }\n\n  FileMessage._summaryType = '文件';\n\n  /**\n   * @name TYPE\n   * @memberof FileMessage\n   * @type Number\n   * @static\n   * @const\n   */\n  IM.messageType(-6)(FileMessage);\n  IM.messageField('_lcfile')(FileMessage);\n  IM.IE10Compatible(FileMessage);\n\n  return FileMessage;\n}\n","export default function createImageMessageClass({ FileMessage, IM }) {\n  /**\n   * 构造方法参数同 {@link FileMessage}\n   *\n   * @extends FileMessage\n   */\n  class ImageMessage extends FileMessage {}\n  ImageMessage._summaryType = '图片';\n\n  /**\n   * @name TYPE\n   * @memberof ImageMessage\n   * @type Number\n   * @static\n   * @const\n   */\n  IM.messageType(-2)(ImageMessage);\n  IM.IE10Compatible(ImageMessage);\n\n  return ImageMessage;\n}\n","export default function createAudioMessageClass({ FileMessage, IM }) {\n  /**\n   * 构造方法参数同 {@link FileMessage}\n   *\n   * @extends FileMessage\n   */\n  class AudioMessage extends FileMessage {}\n  AudioMessage._summaryType = '语音';\n\n  /**\n   * @name TYPE\n   * @memberof AudioMessage\n   * @type Number\n   * @static\n   * @const\n   */\n  IM.messageType(-3)(AudioMessage);\n  IM.IE10Compatible(AudioMessage);\n\n  return AudioMessage;\n}\n","export default function createVideoMessageClass({ FileMessage, IM }) {\n  /**\n   * 构造方法参数同 {@link FileMessage}\n   *\n   * @extends FileMessage\n   */\n  class VideoMessage extends FileMessage {}\n  VideoMessage._summaryType = '视频';\n\n  /**\n   * @name TYPE\n   * @memberof VideoMessage\n   * @type Number\n   * @static\n   * @const\n   */\n  IM.messageType(-4)(VideoMessage);\n  IM.IE10Compatible(VideoMessage);\n\n  return VideoMessage;\n}\n","export default function createLocationMessageClass({ AV, IM }) {\n  class LocationMessage extends IM.TypedMessage {\n    /**\n     * @extends TypedMessage\n     * @param  {AV.GeoPoint} geoPoint LeanCloud 存储 SDK 中的 AV.GeoPoint 实例\n     */\n    constructor(geoPoint) {\n      if (!(geoPoint instanceof AV.GeoPoint)) {\n        throw new TypeError('geoPoint must be an AV.GeoPoint');\n      }\n      super();\n      this._geoPoint = geoPoint;\n      const { latitude, longitude } = geoPoint;\n      this._lcloc = { latitude, longitude };\n    }\n\n    /**\n     * 在客户端需要以文本形式展示该消息时显示的文案，格式为 <code>[位置] message.text</code>\n     * @type {String}\n     * @readonly\n     */\n    get summary() {\n      return `[位置] ${this.text || ''}`.trim();\n    }\n\n    /**\n     * 获得 geoPoint 对象\n     * @return {AV.GeoPoint}\n     */\n    getLocation() {\n      return this._geoPoint;\n    }\n\n    toJSON() {\n      return {\n        ...super.toJSON(),\n        location: this.getLocation().toJSON(),\n      };\n    }\n\n    static parse(json, message) {\n      const { latitude, longitude } = json._lcloc;\n      const geoPoint = new AV.GeoPoint({ latitude, longitude });\n      return IM.TypedMessage.parse(json, message || new this(geoPoint));\n    }\n  }\n\n  /**\n   * @name TYPE\n   * @memberof LocationMessage\n   * @type Number\n   * @static\n   * @const\n   */\n  IM.messageType(-5)(LocationMessage);\n  IM.messageField('_lcloc')(LocationMessage);\n  IM.IE10Compatible(LocationMessage);\n\n  return LocationMessage;\n}\n"],"names":["obj","key","value","Object","defineProperty","enumerable","configurable","writable","_defineProperties","target","props","i","length","descriptor","Constructor","protoProps","staticProps","prototype","subClass","superClass","create","constructor","__proto__","initPlugin","AV","IM","FileMessage","file","File","TypeError","id","Error","_file","_lcfile","objId","url","metaData","assign","name","getFile","this","toJSON","_parseFileFromRawData","data","createWithoutData","attributes","_url","_metaData","_name","parse","json","message","TypedMessage","_summaryType","trim","messageType","messageField","IE10Compatible","createFileMessageClass","ImageMessage","createImageMessageClass","AudioMessage","createAudioMessageClass","VideoMessage","createVideoMessageClass","LocationMessage","geoPoint","GeoPoint","_geoPoint","latitude","longitude","_lcloc","getLocation","location","text","createLocationMessageClass","TypedMessagesPlugin","messageClasses","window"],"mappings":"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"}