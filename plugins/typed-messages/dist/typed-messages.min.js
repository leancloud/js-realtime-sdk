!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("leancloud-storage"),require("leancloud-realtime")):"function"==typeof define&&define.amd?define("typed-messages",["exports","leancloud-storage","leancloud-realtime"],t):t((e=e||self).AV=e.AV||{},e.AV,e.AV)}(this,function(e,i,s){"use strict";function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)}return r}function l(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,r,a;t=n,a=o[r=e],r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function u(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}if(!i.File)throw new Error("LeanCloud Storage SDK not installed");if(!s.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var r=function(r){function e(e){var t;if(!(e instanceof i.File))throw new TypeError("file must be an AV.File");if("string"!=typeof e.id)throw new Error("file must be saved before used to create a Message");return(t=r.call(this)||this)._file=e,t._lcfile={objId:e.id,url:e.url(),metaData:Object.assign(e.metaData()||{},{name:e.name()})},t}u(e,r);var t=e.prototype;return t.getFile=function(){return this._file},t.toJSON=function(){return l({},r.prototype.toJSON.call(this),{file:this.getFile().toJSON()})},e._parseFileFromRawData=function(e){if(!e||!e._lcfile)throw new Error("malformed FileMessage content");var t=e._lcfile.objId;"string"!=typeof t&&(t="");var r=i.File.createWithoutData(t);return r.attributes=r.attributes||{},r._url=e._lcfile.url,r.attributes.url=r._url,r._metaData=e._lcfile.metaData||{},r.attributes.metaData=r._metaData,e._lcfile.metaData&&(r._name=e._lcfile.metaData.name,r.attributes.name=r._name),r},e.parse=function(e,t){var r=this._parseFileFromRawData(e);return s.TypedMessage.parse(e,t||new this(r))},o(e,[{key:"summary",get:function(){return"[".concat(this.constructor._summaryType,"] ").concat(this._file.name()||"").trim()}}]),e}(s.TypedMessage);r._summaryType="文件",s.messageType(-6)(r),s.messageField("_lcfile")(r),s.IE10Compatible(r);var n=function(e){function t(){return e.apply(this,arguments)||this}return u(t,e),t}(r);n._summaryType="图片",s.messageType(-2)(n),s.IE10Compatible(n);var c=function(e){function t(){return e.apply(this,arguments)||this}return u(t,e),t}(r);c._summaryType="语音",s.messageType(-3)(c),s.IE10Compatible(c);var p=function(e){function t(){return e.apply(this,arguments)||this}return u(t,e),t}(r);p._summaryType="视频",s.messageType(-4)(p),s.IE10Compatible(p);var f=function(n){function e(e){var t;if(!(e instanceof i.GeoPoint))throw new TypeError("geoPoint must be an AV.GeoPoint");var r=((t=n.call(this)||this)._geoPoint=e).latitude,a=e.longitude;return t._lcloc={latitude:r,longitude:a},t}u(e,n);var t=e.prototype;return t.getLocation=function(){return this._geoPoint},t.toJSON=function(){return l({},n.prototype.toJSON.call(this),{location:this.getLocation().toJSON()})},e.parse=function(e,t){var r=e._lcloc,a=r.latitude,n=r.longitude,o=new i.GeoPoint({latitude:a,longitude:n});return s.TypedMessage.parse(e,t||new this(o))},o(e,[{key:"summary",get:function(){return"[位置] ".concat(this.text||"").trim()}}]),e}(s.TypedMessage);s.messageType(-5)(f),s.messageField("_lcloc")(f),s.IE10Compatible(f);var m={name:"leancloud-realtime-plugin-typed-messages",messageClasses:[r,n,c,p,f]};e.AudioMessage=c,e.FileMessage=r,e.ImageMessage=n,e.LocationMessage=f,e.TypedMessagesPlugin=m,e.VideoMessage=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=typed-messages.min.js.map
