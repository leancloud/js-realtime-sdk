!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("webrtc",["exports","leancloud-realtime"],b):b(a.AV=a.AV||{},a.AV)}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a.default:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f=function(){},g=function(a,b){return{value:b,done:!!a}},h={},i={}.toString,j=function(a){return i.call(a).slice(8,-1)},k=j,l=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==k(a)?a.split(""):Object(a)},m=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a},n=l,o=m,p=function(a){return n(o(a))},q=d(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),r=d(function(a){var b=a.exports={version:"2.4.0"};"number"==typeof __e&&(__e=b)}),s=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a},t=s,u=function(a,b,c){if(t(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},v=function(a){return"object"==typeof a?null!==a:"function"==typeof a},w=v,x=function(a){if(!w(a))throw TypeError(a+" is not an object!");return a},y=function(a){try{return!!a()}catch(a){return!0}},z=!y(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),A=v,B=q.document,C=A(B)&&A(B.createElement),D=function(a){return C?B.createElement(a):{}},E=!z&&!y(function(){return 7!=Object.defineProperty(D("div"),"a",{get:function(){return 7}}).a}),F=v,G=function(a,b){if(!F(a))return a;var c,d;if(b&&"function"==typeof(c=a.toString)&&!F(d=c.call(a)))return d;if("function"==typeof(c=a.valueOf)&&!F(d=c.call(a)))return d;if(!b&&"function"==typeof(c=a.toString)&&!F(d=c.call(a)))return d;throw TypeError("Can't convert object to primitive value")},H=x,I=E,J=G,K=Object.defineProperty,L=z?Object.defineProperty:function(a,b,c){if(H(a),b=J(b,!0),H(c),I)try{return K(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a},M={f:L},N=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}},O=M,P=N,Q=z?function(a,b,c){return O.f(a,b,P(1,c))}:function(a,b,c){return a[b]=c,a},R=q,S=r,T=u,U=Q,V=function(a,b,c){var d,e,f,g=a&V.F,h=a&V.G,i=a&V.S,j=a&V.P,k=a&V.B,l=a&V.W,m=h?S:S[b]||(S[b]={}),n=m.prototype,o=h?R:i?R[b]:(R[b]||{}).prototype;h&&(c=b);for(d in c)(e=!g&&o&&void 0!==o[d])&&d in m||(f=e?o[d]:c[d],m[d]=h&&"function"!=typeof o[d]?c[d]:k&&e?T(f,R):l&&o[d]==f?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b.prototype=a.prototype,b}(f):j&&"function"==typeof f?T(Function.call,f):f,j&&((m.virtual||(m.virtual={}))[d]=f,a&V.R&&n&&!n[d]&&U(n,d,f)))};V.F=1,V.G=2,V.S=4,V.P=8,V.B=16,V.W=32,V.U=64,V.R=128;var W=V,X=Q,Y={}.hasOwnProperty,Z=function(a,b){return Y.call(a,b)},$=Math.ceil,_=Math.floor,aa=function(a){return isNaN(a=+a)?0:(a>0?_:$)(a)},ba=aa,ca=Math.min,da=function(a){return a>0?ca(ba(a),9007199254740991):0},ea=aa,fa=Math.max,ga=Math.min,ha=function(a,b){return a=ea(a),a<0?fa(a+b,0):ga(a,b)},ia=p,ja=da,ka=ha,la=q,ma=la["__core-js_shared__"]||(la["__core-js_shared__"]={}),na=function(a){return ma[a]||(ma[a]={})},oa=0,pa=Math.random(),qa=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++oa+pa).toString(36))},ra=na("keys"),sa=qa,ta=function(a){return ra[a]||(ra[a]=sa(a))},ua=Z,va=p,wa=function(a){return function(b,c,d){var e,f=ia(b),g=ja(f.length),h=ka(d,g);if(a&&c!=c){for(;g>h;)if((e=f[h++])!=e)return!0}else for(;g>h;h++)if((a||h in f)&&f[h]===c)return a||h||0;return!a&&-1}}(!1),xa=ta("IE_PROTO"),ya=function(a,b){var c,d=va(a),e=0,f=[];for(c in d)c!=xa&&ua(d,c)&&f.push(c);for(;b.length>e;)ua(d,c=b[e++])&&(~wa(f,c)||f.push(c));return f},za="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Aa=ya,Ba=za,Ca=Object.keys||function(a){return Aa(a,Ba)},Da=M,Ea=x,Fa=Ca,Ga=z?Object.defineProperties:function(a,b){Ea(a);for(var c,d=Fa(b),e=d.length,f=0;e>f;)Da.f(a,c=d[f++],b[c]);return a},Ha=q.document&&document.documentElement,Ia=x,Ja=Ga,Ka=za,La=ta("IE_PROTO"),Ma=function(){},Na=function(){var a,b=D("iframe"),c=Ka.length;for(b.style.display="none",Ha.appendChild(b),b.src="javascript:",a=b.contentWindow.document,a.open(),a.write("<script>document.F=Object</script>"),a.close(),Na=a.F;c--;)delete Na.prototype[Ka[c]];return Na()},Oa=Object.create||function(a,b){var c;return null!==a?(Ma.prototype=Ia(a),c=new Ma,Ma.prototype=null,c[La]=a):c=Na(),void 0===b?c:Ja(c,b)},Pa=d(function(a){var b=na("wks"),c=qa,d=q.Symbol,e="function"==typeof d;(a.exports=function(a){return b[a]||(b[a]=e&&d[a]||(e?d:c)("Symbol."+a))}).store=b}),Qa=M.f,Ra=Z,Sa=Pa("toStringTag"),Ta=function(a,b,c){a&&!Ra(a=c?a:a.prototype,Sa)&&Qa(a,Sa,{configurable:!0,value:b})},Ua=Oa,Va=N,Wa=Ta,Xa={};Q(Xa,Pa("iterator"),function(){return this});var Ya=function(a,b,c){a.prototype=Ua(Xa,{next:Va(1,c)}),Wa(a,b+" Iterator")},Za=m,$a=function(a){return Object(Za(a))},_a=Z,ab=$a,bb=ta("IE_PROTO"),cb=Object.prototype,db=Object.getPrototypeOf||function(a){return a=ab(a),_a(a,bb)?a[bb]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?cb:null},eb=W,fb=X,gb=Q,hb=h,ib=Ya,jb=Ta,kb=db,lb=Pa("iterator"),mb=!([].keys&&"next"in[].keys()),nb=function(){return this},ob=function(a,b,c,d,e,f,g){ib(c,b,d);var h,i,j,k=function(a){if(!mb&&a in o)return o[a];switch(a){case"keys":case"values":return function(){return new c(this,a)}}return function(){return new c(this,a)}},l=b+" Iterator",m="values"==e,n=!1,o=a.prototype,p=o[lb]||o["@@iterator"]||e&&o[e],q=p||k(e),r=e?m?k("entries"):q:void 0,s="Array"==b?o.entries||p:p;if(s&&(j=kb(s.call(new a)))!==Object.prototype&&jb(j,l,!0),m&&p&&"values"!==p.name&&(n=!0,q=function(){return p.call(this)}),g&&(mb||n||!o[lb])&&gb(o,lb,q),hb[b]=q,hb[l]=nb,e)if(h={values:m?q:k("values"),keys:f?q:k("keys"),entries:r},g)for(i in h)i in o||fb(o,i,h[i]);else eb(eb.P+eb.F*(mb||n),b,h);return h},pb=f,qb=g,rb=h,sb=p;ob(Array,"Array",function(a,b){this._t=sb(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,qb(1)):"keys"==b?qb(0,c):"values"==b?qb(0,a[c]):qb(0,[c,a[c]])},"values");rb.Arguments=rb.Array,pb("keys"),pb("values"),pb("entries");for(var tb=q,ub=Q,vb=h,wb=Pa("toStringTag"),xb=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],yb=0;yb<5;yb++){var zb=xb[yb],Ab=tb[zb],Bb=Ab&&Ab.prototype;Bb&&!Bb[wb]&&ub(Bb,wb,zb),vb[zb]=vb.Array}var Cb=aa,Db=m,Eb=function(a){return function(b,c){var d,e,f=String(Db(b)),g=Cb(c),h=f.length;return g<0||g>=h?a?"":void 0:(d=f.charCodeAt(g),d<55296||d>56319||g+1===h||(e=f.charCodeAt(g+1))<56320||e>57343?a?f.charAt(g):d:a?f.slice(g,g+2):e-56320+(d-55296<<10)+65536)}}(!0);ob(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,b=this._t,c=this._i;return c>=b.length?{value:void 0,done:!0}:(a=Eb(b,c),this._i+=a.length,{value:a,done:!1})});var Fb,Gb,Hb,Ib=j,Jb=Pa("toStringTag"),Kb="Arguments"==Ib(function(){return arguments}()),Lb=function(a,b){try{return a[b]}catch(a){}},Mb=function(a){var b,c,d;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=Lb(b=Object(a),Jb))?c:Kb?Ib(b):"Object"==(d=Ib(b))&&"function"==typeof b.callee?"Arguments":d},Nb=Mb,Ob=Pa("iterator"),Pb=h,Qb=r.isIterable=function(a){var b=Object(a);return void 0!==b[Ob]||"@@iterator"in b||Pb.hasOwnProperty(Nb(b))},Rb=Qb,Sb=d(function(a){a.exports={default:Rb,__esModule:!0}}),Tb=Mb,Ub=Pa("iterator"),Vb=h,Wb=r.getIteratorMethod=function(a){if(void 0!=a)return a[Ub]||a["@@iterator"]||Vb[Tb(a)]},Xb=x,Yb=Wb,Zb=r.getIterator=function(a){var b=Yb(a);if("function"!=typeof b)throw TypeError(a+" is not iterable!");return Xb(b.call(a))},$b=Zb,_b=d(function(a){a.exports={default:$b,__esModule:!0}}),ac=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=Sb,e=c(d),f=_b,g=c(f);b.default=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var h,i=(0,g.default)(a);!(d=(h=i.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if((0,e.default)(Object(b)))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),bc=c(ac),cc=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a},dc=x,ec=function(a,b,c,d){try{return d?b(dc(c)[0],c[1]):b(c)}catch(b){var e=a.return;throw void 0!==e&&dc(e.call(a)),b}},fc=h,gc=Pa("iterator"),hc=Array.prototype,ic=function(a){return void 0!==a&&(fc.Array===a||hc[gc]===a)},jc=d(function(a){var b=u,c=ec,d=ic,e=x,f=da,g=Wb,h={},i={},j=a.exports=function(a,j,k,l,m){var n,o,p,q,r=m?function(){return a}:g(a),s=b(k,l,j?2:1),t=0;if("function"!=typeof r)throw TypeError(a+" is not iterable!");if(d(r)){for(n=f(a.length);n>t;t++)if((q=j?s(e(o=a[t])[0],o[1]):s(a[t]))===h||q===i)return q}else for(p=r.call(a);!(o=p.next()).done;)if((q=c(p,s,o.value,j))===h||q===i)return q};j.BREAK=h,j.RETURN=i}),kc=x,lc=s,mc=Pa("species"),nc=function(a,b){var c,d=kc(a).constructor;return void 0===d||void 0==(c=kc(d)[mc])?b:lc(c)},oc=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)},pc=u,qc=oc,rc=Ha,sc=D,tc=q,uc=tc.process,vc=tc.setImmediate,wc=tc.clearImmediate,xc=tc.MessageChannel,yc=0,zc={},Ac=function(){var a=+this;if(zc.hasOwnProperty(a)){var b=zc[a];delete zc[a],b()}},Bc=function(a){Ac.call(a.data)};vc&&wc||(vc=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return zc[++yc]=function(){qc("function"==typeof a?a:Function(a),b)},Fb(yc),yc},wc=function(a){delete zc[a]},"process"==j(uc)?Fb=function(a){uc.nextTick(pc(Ac,a,1))}:xc?(Gb=new xc,Hb=Gb.port2,Gb.port1.onmessage=Bc,Fb=pc(Hb.postMessage,Hb,1)):tc.addEventListener&&"function"==typeof postMessage&&!tc.importScripts?(Fb=function(a){tc.postMessage(a+"","*")},tc.addEventListener("message",Bc,!1)):Fb="onreadystatechange"in sc("script")?function(a){rc.appendChild(sc("script")).onreadystatechange=function(){rc.removeChild(this),Ac.call(a)}}:function(a){setTimeout(pc(Ac,a,1),0)});var Cc={set:vc,clear:wc},Dc=q,Ec=Cc.set,Fc=Dc.MutationObserver||Dc.WebKitMutationObserver,Gc=Dc.process,Hc=Dc.Promise,Ic="process"==j(Gc),Jc=Q,Kc=q,Lc=r,Mc=M,Nc=z,Oc=Pa("species"),Pc=Pa("iterator"),Qc=!1;try{var Rc=[7][Pc]();Rc.return=function(){Qc=!0},Array.from(Rc,function(){throw 2})}catch(a){}var Sc,Tc,Uc,Vc=q,Wc=u,Xc=Mb,Yc=W,Zc=v,$c=s,_c=cc,ad=jc,bd=nc,cd=Cc.set,dd=function(){var a,b,c,d=function(){var d,e;for(Ic&&(d=Gc.domain)&&d.exit();a;){e=a.fn,a=a.next;try{e()}catch(d){throw a?c():b=void 0,d}}b=void 0,d&&d.enter()};if(Ic)c=function(){Gc.nextTick(d)};else if(Fc){var e=!0,f=document.createTextNode("");new Fc(d).observe(f,{characterData:!0}),c=function(){f.data=e=!e}}else if(Hc&&Hc.resolve){var g=Hc.resolve();c=function(){g.then(d)}}else c=function(){Ec.call(Dc,d)};return function(d){var e={fn:d,next:void 0};b&&(b.next=e),a||(a=e,c()),b=e}}(),ed=Vc.TypeError,fd=Vc.process,gd=Vc.Promise,fd=Vc.process,hd="process"==Xc(fd),id=function(){},jd=!!function(){try{var a=gd.resolve(1),b=(a.constructor={})[Pa("species")]=function(a){a(id,id)};return(hd||"function"==typeof PromiseRejectionEvent)&&a.then(id)instanceof b}catch(a){}}(),kd=function(a,b){return a===b||a===gd&&b===Uc},ld=function(a){var b;return!(!Zc(a)||"function"!=typeof(b=a.then))&&b},md=function(a){return kd(gd,a)?new nd(a):new Tc(a)},nd=Tc=function(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw ed("Bad Promise constructor");b=a,c=d}),this.resolve=$c(b),this.reject=$c(c)},od=function(a){try{a()}catch(a){return{error:a}}},pd=function(a,b){if(!a._n){a._n=!0;var c=a._c;dd(function(){for(var d=a._v,e=1==a._s,f=0;c.length>f;)!function(b){var c,f,g=e?b.ok:b.fail,h=b.resolve,i=b.reject,j=b.domain;try{g?(e||(2==a._h&&sd(a),a._h=1),!0===g?c=d:(j&&j.enter(),c=g(d),j&&j.exit()),c===b.promise?i(ed("Promise-chain cycle")):(f=ld(c))?f.call(c,h,i):h(c)):i(d)}catch(a){i(a)}}(c[f++]);a._c=[],a._n=!1,b&&!a._h&&qd(a)})}},qd=function(a){cd.call(Vc,function(){var b,c,d,e=a._v;if(rd(a)&&(b=od(function(){hd?fd.emit("unhandledRejection",e,a):(c=Vc.onunhandledrejection)?c({promise:a,reason:e}):(d=Vc.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=hd||rd(a)?2:1),a._a=void 0,b)throw b.error})},rd=function(a){if(1==a._h)return!1;for(var b,c=a._a||a._c,d=0;c.length>d;)if(b=c[d++],b.fail||!rd(b.promise))return!1;return!0},sd=function(a){cd.call(Vc,function(){var b;hd?fd.emit("rejectionHandled",a):(b=Vc.onrejectionhandled)&&b({promise:a,reason:a._v})})},td=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),pd(b,!0))},ud=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw ed("Promise can't be resolved itself");(b=ld(a))?dd(function(){var d={_w:c,_d:!1};try{b.call(a,Wc(ud,d,1),Wc(td,d,1))}catch(a){td.call(d,a)}}):(c._v=a,c._s=1,pd(c,!1))}catch(a){td.call({_w:c,_d:!1},a)}}};jd||(gd=function(a){_c(this,gd,"Promise","_h"),$c(a),Sc.call(this);try{a(Wc(ud,this,1),Wc(td,this,1))}catch(a){td.call(this,a)}},Sc=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},Sc.prototype=function(a,b,c){for(var d in b)c&&a[d]?a[d]=b[d]:Jc(a,d,b[d]);return a}(gd.prototype,{then:function(a,b){var c=md(bd(this,gd));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=hd?fd.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&pd(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),nd=function(){var a=new Sc;this.promise=a,this.resolve=Wc(ud,a,1),this.reject=Wc(td,a,1)}),Yc(Yc.G+Yc.W+Yc.F*!jd,{Promise:gd}),Ta(gd,"Promise"),function(a){var b="function"==typeof Lc[a]?Lc[a]:Kc[a];Nc&&b&&!b[Oc]&&Mc.f(b,Oc,{configurable:!0,get:function(){return this}})}("Promise"),Uc=r.Promise,Yc(Yc.S+Yc.F*!jd,"Promise",{reject:function(a){var b=md(this);return(0,b.reject)(a),b.promise}}),Yc(Yc.S+!0*Yc.F,"Promise",{resolve:function(a){if(a instanceof gd&&kd(a.constructor,this))return a;var b=md(this);return(0,b.resolve)(a),b.promise}}),Yc(Yc.S+Yc.F*!(jd&&function(a,b){if(!b&&!Qc)return!1;var c=!1;try{var d=[7],e=d[Pc]();e.next=function(){return{done:c=!0}},d[Pc]=function(){return e},a(d)}catch(a){}return c}(function(a){gd.all(a).catch(id)})),"Promise",{all:function(a){var b=this,c=md(b),d=c.resolve,e=c.reject,f=od(function(){var c=[],f=0,g=1;ad(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f&&e(f.error),c.promise},race:function(a){var b=this,c=md(b),d=c.reject,e=od(function(){ad(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e&&d(e.error),c.promise}});var vd=r.Promise,wd=d(function(a){a.exports={default:vd,__esModule:!0}}),xd=c(wd),yd=Object.getOwnPropertySymbols,zd={f:yd},Ad={}.propertyIsEnumerable,Bd={f:Ad},Cd=Ca,Dd=zd,Ed=Bd,Fd=$a,Gd=l,Hd=Object.assign,Id=!Hd||y(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=Hd({},a)[c]||Object.keys(Hd({},b)).join("")!=d})?function(a,b){for(var c=Fd(a),d=arguments.length,e=1,f=Dd.f,g=Ed.f;d>e;)for(var h,i=Gd(arguments[e++]),j=f?Cd(i).concat(f(i)):Cd(i),k=j.length,l=0;k>l;)g.call(i,h=j[l++])&&(c[h]=i[h]);return c}:Hd,Jd=W;Jd(Jd.S+Jd.F,"Object",{assign:Id});var Kd=r.Object.assign,Ld=d(function(a){a.exports={default:Kd,__esModule:!0}}),Md=c(Ld),Nd=d(function(a,b){b.__esModule=!0,b.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}}),Od=c(Nd),Pd=Pa,Qd={f:Pd},Rd=Qd.f("iterator"),Sd=d(function(a){a.exports={default:Rd,__esModule:!0}}),Td=d(function(a){var b=qa("meta"),c=v,d=Z,e=M.f,f=0,g=Object.isExtensible||function(){return!0},h=!y(function(){return g(Object.preventExtensions({}))}),i=function(a){e(a,b,{value:{i:"O"+ ++f,w:{}}})},j=function(a,e){if(!c(a))return"symbol"==typeof a?a:("string"==typeof a?"S":"P")+a;if(!d(a,b)){if(!g(a))return"F";if(!e)return"E";i(a)}return a[b].i},k=function(a,c){if(!d(a,b)){if(!g(a))return!0;if(!c)return!1;i(a)}return a[b].w},l=function(a){return h&&m.NEED&&g(a)&&!d(a,b)&&i(a),a},m=a.exports={KEY:b,NEED:!1,fastKey:j,getWeak:k,onFreeze:l}}),Ud=r,Vd=Qd,Wd=M.f,Xd=function(a){var b=Ud.Symbol||(Ud.Symbol={});"_"==a.charAt(0)||a in b||Wd(b,a,{value:Vd.f(a)})},Yd=Ca,Zd=p,$d=function(a,b){for(var c,d=Zd(a),e=Yd(d),f=e.length,g=0;f>g;)if(d[c=e[g++]]===b)return c},_d=Ca,ae=zd,be=Bd,ce=function(a){var b=_d(a),c=ae.f;if(c)for(var d,e=c(a),f=be.f,g=0;e.length>g;)f.call(a,d=e[g++])&&b.push(d);return b},de=j,ee=Array.isArray||function(a){return"Array"==de(a)},fe=ya,ge=za.concat("length","prototype"),he=Object.getOwnPropertyNames||function(a){return fe(a,ge)},ie={f:he},je=p,ke=ie.f,le={}.toString,me="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ne=function(a){try{return ke(a)}catch(a){return me.slice()}},oe=function(a){return me&&"[object Window]"==le.call(a)?ne(a):ke(je(a))},pe={f:oe},qe=Bd,re=N,se=p,te=G,ue=Z,ve=E,we=Object.getOwnPropertyDescriptor,xe=z?we:function(a,b){if(a=se(a),b=te(b,!0),ve)try{return we(a,b)}catch(a){}if(ue(a,b))return re(!qe.f.call(a,b),a[b])},ye={f:xe},ze=q,Ae=Z,Be=z,Ce=W,De=X,Ee=Td.KEY,Fe=y,Ge=na,He=Ta,Ie=qa,Je=Pa,Ke=Qd,Le=Xd,Me=$d,Ne=ce,Oe=ee,Pe=x,Qe=p,Re=G,Se=N,Te=Oa,Ue=pe,Ve=ye,We=M,Xe=Ca,Ye=Ve.f,Ze=We.f,$e=Ue.f,_e=ze.Symbol,af=ze.JSON,bf=af&&af.stringify,cf=Je("_hidden"),df=Je("toPrimitive"),ef={}.propertyIsEnumerable,ff=Ge("symbol-registry"),gf=Ge("symbols"),hf=Ge("op-symbols"),jf=Object.prototype,kf="function"==typeof _e,lf=ze.QObject,mf=!lf||!lf.prototype||!lf.prototype.findChild,nf=Be&&Fe(function(){return 7!=Te(Ze({},"a",{get:function(){return Ze(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=Ye(jf,b);d&&delete jf[b],Ze(a,b,c),d&&a!==jf&&Ze(jf,b,d)}:Ze,of=function(a){var b=gf[a]=Te(_e.prototype);return b._k=a,b},pf=kf&&"symbol"==typeof _e.iterator?function(a){return"symbol"==typeof a}:function(a){return a instanceof _e},qf=function(a,b,c){return a===jf&&qf(hf,b,c),Pe(a),b=Re(b,!0),Pe(c),Ae(gf,b)?(c.enumerable?(Ae(a,cf)&&a[cf][b]&&(a[cf][b]=!1),c=Te(c,{enumerable:Se(0,!1)})):(Ae(a,cf)||Ze(a,cf,Se(1,{})),a[cf][b]=!0),nf(a,b,c)):Ze(a,b,c)},rf=function(a,b){Pe(a);for(var c,d=Ne(b=Qe(b)),e=0,f=d.length;f>e;)qf(a,c=d[e++],b[c]);return a},sf=function(a,b){return void 0===b?Te(a):rf(Te(a),b)},tf=function(a){var b=ef.call(this,a=Re(a,!0));return!(this===jf&&Ae(gf,a)&&!Ae(hf,a))&&(!(b||!Ae(this,a)||!Ae(gf,a)||Ae(this,cf)&&this[cf][a])||b)},uf=function(a,b){if(a=Qe(a),b=Re(b,!0),a!==jf||!Ae(gf,b)||Ae(hf,b)){var c=Ye(a,b);return!c||!Ae(gf,b)||Ae(a,cf)&&a[cf][b]||(c.enumerable=!0),c}},vf=function(a){for(var b,c=$e(Qe(a)),d=[],e=0;c.length>e;)Ae(gf,b=c[e++])||b==cf||b==Ee||d.push(b);return d},wf=function(a){for(var b,c=a===jf,d=$e(c?hf:Qe(a)),e=[],f=0;d.length>f;)!Ae(gf,b=d[f++])||c&&!Ae(jf,b)||e.push(gf[b]);return e};kf||(_e=function(){if(this instanceof _e)throw TypeError("Symbol is not a constructor!");var a=Ie(arguments.length>0?arguments[0]:void 0),b=function(c){this===jf&&b.call(hf,c),Ae(this,cf)&&Ae(this[cf],a)&&(this[cf][a]=!1),nf(this,a,Se(1,c))};return Be&&mf&&nf(jf,a,{configurable:!0,set:b}),of(a)},De(_e.prototype,"toString",function(){return this._k}),Ve.f=uf,We.f=qf,ie.f=Ue.f=vf,Bd.f=tf,zd.f=wf,Ke.f=function(a){return of(Je(a))}),Ce(Ce.G+Ce.W+Ce.F*!kf,{Symbol:_e});for(var xf="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),yf=0;xf.length>yf;)Je(xf[yf++]);for(var xf=Xe(Je.store),yf=0;xf.length>yf;)Le(xf[yf++]);Ce(Ce.S+Ce.F*!kf,"Symbol",{for:function(a){return Ae(ff,a+="")?ff[a]:ff[a]=_e(a)},keyFor:function(a){if(pf(a))return Me(ff,a);throw TypeError(a+" is not a symbol!")},useSetter:function(){mf=!0},useSimple:function(){mf=!1}}),Ce(Ce.S+Ce.F*!kf,"Object",{create:sf,defineProperty:qf,defineProperties:rf,getOwnPropertyDescriptor:uf,getOwnPropertyNames:vf,getOwnPropertySymbols:wf}),af&&Ce(Ce.S+Ce.F*(!kf||Fe(function(){var a=_e();return"[null]"!=bf([a])||"{}"!=bf({a:a})||"{}"!=bf(Object(a))})),"JSON",{stringify:function(a){if(void 0!==a&&!pf(a)){for(var b,c,d=[a],e=1;arguments.length>e;)d.push(arguments[e++]);return b=d[1],"function"==typeof b&&(c=b),!c&&Oe(b)||(b=function(a,b){if(c&&(b=c.call(this,a,b)),!pf(b))return b}),d[1]=b,bf.apply(af,d)}}}),_e.prototype[df]||Q(_e.prototype,df,_e.prototype.valueOf),He(_e,"Symbol"),He(Math,"Math",!0),He(ze.JSON,"JSON",!0),Xd("asyncIterator"),Xd("observable");var zf=r.Symbol,Af=d(function(a){a.exports={default:zf,__esModule:!0}}),Bf=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=Sd,e=c(d),f=Af,g=c(f),h="function"==typeof g.default&&"symbol"==typeof e.default?function(a){return typeof a}:function(a){return a&&"function"==typeof g.default&&a.constructor===g.default&&a!==g.default.prototype?"symbol":typeof a};b.default="function"==typeof g.default&&"symbol"===h(e.default)?function(a){return void 0===a?"undefined":h(a)}:function(a){return a&&"function"==typeof g.default&&a.constructor===g.default&&a!==g.default.prototype?"symbol":void 0===a?"undefined":h(a)}}),Cf=d(function(a,b){b.__esModule=!0;var c=Bf,d=function(a){return a&&a.__esModule?a:{default:a}}(c);b.default=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":(0,d.default)(b))&&"function"!=typeof b?a:b}}),Df=c(Cf),Ef=v,Ff=x,Gf=function(a,b){if(Ff(a),!Ef(b)&&null!==b)throw TypeError(b+": can't set as prototype!")},Hf={set:Object.setPrototypeOf||("__proto__"in{}?function(a,b,c){try{c=u(Function.call,ye.f(Object.prototype,"__proto__").set,2),c(a,[]),b=!(a instanceof Array)}catch(a){b=!0}return function(a,d){return Gf(a,d),b?a.__proto__=d:c(a,d),a}}({},!1):void 0),check:Gf},If=W;If(If.S,"Object",{setPrototypeOf:Hf.set});var Jf=r.Object.setPrototypeOf,Kf=d(function(a){a.exports={default:Jf,__esModule:!0}}),Lf=W;Lf(Lf.S,"Object",{create:Oa});var Mf=r.Object,Nf=function(a,b){return Mf.create(a,b)},Of=d(function(a){a.exports={default:Nf,__esModule:!0}}),Pf=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=Kf,e=c(d),f=Of,g=c(f),h=Bf,i=c(h);b.default=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":(0,i.default)(b)));a.prototype=(0,g.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(e.default?(0,e.default)(a,b):a.__proto__=b)}}),Qf=c(Pf),Rf=d(function(a){function b(){}function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){this._events=new b,this._eventsCount=0}var e=Object.prototype.hasOwnProperty,f="~";Object.create&&(b.prototype=Object.create(null),(new b).__proto__||(f=!1)),d.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)e.call(a,b)&&c.push(f?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},d.prototype.listeners=function(a,b){var c=f?f+a:a,d=this._events[c];if(b)return!!d;if(!d)return[];if(d.fn)return[d.fn];for(var e=0,g=d.length,h=new Array(g);e<g;e++)h[e]=d[e].fn;return h},d.prototype.emit=function(a,b,c,d,e,g){var h=f?f+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,g),!0}for(j=1,i=new Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=new Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},d.prototype.on=function(a,b,d){var e=new c(b,d||this),g=f?f+a:a;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],e]:this._events[g].push(e):(this._events[g]=e,this._eventsCount++),this},d.prototype.once=function(a,b,d){var e=new c(b,d||this,!0),g=f?f+a:a;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],e]:this._events[g].push(e):(this._events[g]=e,this._eventsCount++),this},d.prototype.removeListener=function(a,c,d,e){var g=f?f+a:a;if(!this._events[g])return this;if(!c)return 0==--this._eventsCount?this._events=new b:delete this._events[g],this;var h=this._events[g];if(h.fn)h.fn!==c||e&&!h.once||d&&h.context!==d||(0==--this._eventsCount?this._events=new b:delete this._events[g]);else{for(var i=0,j=[],k=h.length;i<k;i++)(h[i].fn!==c||e&&!h[i].once||d&&h[i].context!==d)&&j.push(h[i]);j.length?this._events[g]=1===j.length?j[0]:j:0==--this._eventsCount?this._events=new b:delete this._events[g]}return this},d.prototype.removeAllListeners=function(a){var c;return a?(c=f?f+a:a,this._events[c]&&(0==--this._eventsCount?this._events=new b:delete this._events[c])):(this._events=new b,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.prefixed=f,d.EventEmitter=d,a.exports=d}),Sf=W;Sf(Sf.S+Sf.F*!z,"Object",{defineProperty:M.f});var Tf=r.Object,Uf=function(a,b,c){return Tf.defineProperty(a,b,c)},Vf=d(function(a){a.exports={default:Uf,__esModule:!0}}),Wf=d(function(a,b){b.__esModule=!0;var c=Vf,d=function(a){return a&&a.__esModule?a:{default:a}}(c);b.default=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),(0,d.default)(a,e.key,e)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()}),Xf=c(Wf),Yf=d(function(a,b){!function(){var c={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var d="string"==typeof a.initial?{state:a.initial}:a.initial,e=a.terminal||a.final,f=b||a.target||{},g=a.events||[],h=a.callbacks||{},i={},j={},k=function(a){var b=Array.isArray(a.from)?a.from:a.from?[a.from]:[c.WILDCARD];i[a.name]=i[a.name]||{};for(var d=0;d<b.length;d++)j[b[d]]=j[b[d]]||[],j[b[d]].push(a.name),i[a.name][b[d]]=a.to||b[d];a.to&&(j[a.to]=j[a.to]||[])};d&&(d.event=d.event||"startup",k({name:d.event,from:"none",to:d.state}));for(var l=0;l<g.length;l++)k(g[l]);for(var m in i)i.hasOwnProperty(m)&&(f[m]=c.buildEvent(m,i[m]));for(var m in h)h.hasOwnProperty(m)&&(f[m]=h[m]);return f.current="none",f.is=function(a){return Array.isArray(a)?a.indexOf(this.current)>=0:this.current===a},f.can=function(a){return!this.transition&&void 0!==i[a]&&(i[a].hasOwnProperty(this.current)||i[a].hasOwnProperty(c.WILDCARD))},f.cannot=function(a){return!this.can(a)},f.transitions=function(){return(j[this.current]||[]).concat(j[c.WILDCARD]||[])},f.isFinished=function(){return this.is(e)},f.error=a.error||function(a,b,c,d,e,f,g){throw g||f},f.states=function(){return Object.keys(j).sort()},d&&!d.defer&&f[d.event](),f},doCallback:function(a,b,d,e,f,g){if(b)try{return b.apply(a,[d,e,f].concat(g))}catch(b){return a.error(d,e,f,g,c.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",b)}},beforeAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onbeforeevent,b,d,e,f)},afterAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onafterevent||a.onevent,b,d,e,f)},leaveAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onleavestate,b,d,e,f)},enterAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onenterstate||a.onstate,b,d,e,f)},changeState:function(a,b,d,e,f){return c.doCallback(a,a.onchangestate,b,d,e,f)},beforeThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onbefore"+b],b,d,e,f)},afterThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onafter"+b]||a["on"+b],b,d,e,f)},leaveThisState:function(a,b,d,e,f){return c.doCallback(a,a["onleave"+d],b,d,e,f)},enterThisState:function(a,b,d,e,f){return c.doCallback(a,a["onenter"+e]||a["on"+e],b,d,e,f)},beforeEvent:function(a,b,d,e,f){if(!1===c.beforeThisEvent(a,b,d,e,f)||!1===c.beforeAnyEvent(a,b,d,e,f))return!1},afterEvent:function(a,b,d,e,f){c.afterThisEvent(a,b,d,e,f),c.afterAnyEvent(a,b,d,e,f)},leaveState:function(a,b,d,e,f){var g=c.leaveThisState(a,b,d,e,f),h=c.leaveAnyState(a,b,d,e,f);return!1!==g&&!1!==h&&(c.ASYNC===g||c.ASYNC===h?c.ASYNC:void 0)},enterState:function(a,b,d,e,f){c.enterThisState(a,b,d,e,f),c.enterAnyState(a,b,d,e,f)},buildEvent:function(a,b){return function(){var d=this.current,e=b[d]||(b[c.WILDCARD]!=c.WILDCARD?b[c.WILDCARD]:d)||d,f=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,d,e,f,c.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,d,e,f,c.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===c.beforeEvent(this,a,d,e,f))return c.Result.CANCELLED;if(d===e)return c.afterEvent(this,a,d,e,f),c.Result.NOTRANSITION;var g=this;this.transition=function(){return g.transition=null,g.current=e,c.enterState(g,a,d,e,f),c.changeState(g,a,d,e,f),c.afterEvent(g,a,d,e,f),c.Result.SUCCEEDED},this.transition.cancel=function(){g.transition=null,c.afterEvent(g,a,d,e,f)};var h=c.leaveState(this,a,d,e,f);return!1===h?(this.transition=null,c.Result.CANCELLED):c.ASYNC===h?c.Result.PENDING:this.transition?this.transition():void 0}}};a.exports&&(b=a.exports=c),b.StateMachine=c}()}),Zf=function(){return Yf.create({initial:"calling",events:[{name:"connect",from:"calling",to:"connected"},{name:"close",from:"connected",to:"closed"},{name:"cancel",from:"calling",to:"canceled"},{name:"refuse",from:"calling",to:"refused"}]})},$f=d(function(a,b){!function(b){function c(a){var b=k(a);if(q)for(var c,d=0;c=t[d++];)a.hasOwnProperty(c)&&b.push(c);return b}function d(a,b,d){for(var e,f,h=c(d),i=0,j=h.length;i<j;)"__self"!==(e=h[i++])&&(f=d[e],!o(f)||f.prototype&&f.prototype.__self||g&&!(f.toString().indexOf(".__base")>-1)?b[e]=f:b[e]=function(c,d){var e=a[c]?a[c]:"__constructor"===c?b.__self.__parent:p,f=function(){var a=this.__base;this.__base=f.__base;var b=d.apply(this,arguments);return this.__base=a,b};return f.__base=e,f}(e,f))}function e(a,b){for(var c,d=1;c=a[d++];)b?o(c)?f.self(b,c.prototype,c):f.self(b,c):b=o(c)?f(a[0],c.prototype,c):f(a[0],c);return b||a[0]}function f(){var a=arguments,b=n(a[0]),c=b||o(a[0]),f=c?b?e(a[0]):a[0]:h,g=a[c?1:0]||{},i=a[c?2:1],k=g.__constructor||c&&f.prototype&&f.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:c?function(){return f.apply(this,arguments)}:function(){};if(!c)return k.prototype=g,k.prototype.__self=k.prototype.constructor=k,l(k,i);l(k,f),
k.__parent=f;var m=f.prototype,p=k.prototype=j(m);return p.__self=p.constructor=k,g&&d(m,p,g),i&&d(f,k,i),k}var g=function(){return"_"}.toString().indexOf("_")>-1,h=function(){},i=Object.prototype.hasOwnProperty,j=Object.create||function(a){var b=function(){};return b.prototype=a,new b},k=Object.keys||function(a){var b=[];for(var c in a)i.call(a,c)&&b.push(c);return b},l=function(a,b){for(var c in b)i.call(b,c)&&(a[c]=b[c]);return a},m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=function(a){return"[object Function]"===m.call(a)},p=function(){},q=!0,r={toString:""};for(var s in r)r.hasOwnProperty(s)&&(q=!1);var t=q?["toString","valueOf"]:null;f.self=function(){var a=arguments,b=n(a[0]),c=b?e(a[0],a[0][0]):a[0],f=a[1],g=a[2],h=c.prototype;return f&&d(h,h,f),g&&d(c,c,g),c};var u=!0;a.exports=f,u=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(a){a(f)}),u=!1),u&&(b.inherit=f)}(e)}),_f=$f;if(!b.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var ag=_f(b.TypedMessage,{__constructor:function(a){this.__base(),this.payload=a,this.setTransient(!0)}});b.messageField("payload")(ag);var bg,cg,dg,eg,fg,gg,hg,ig,jg,kg,lg=(bg=b.messageType(-102))(cg=function(a){function b(){return Od(this,b),Df(this,a.apply(this,arguments))}return Qf(b,a),b}(ag))||cg,mg=(dg=b.messageType(-103))(eg=function(a){function b(){return Od(this,b),Df(this,a.apply(this,arguments))}return Qf(b,a),b}(ag))||eg,ng=(fg=b.messageType(-104))(gg=function(a){function b(){return Od(this,b),Df(this,a.apply(this,arguments))}return Qf(b,a),b}(ag))||gg,og=(hg=b.messageType(-105))(ig=function(a){function b(){return Od(this,b),Df(this,a.apply(this,arguments))}return Qf(b,a),b}(ag))||ig,pg=function(a){function b(c,d){Od(this,b);var e=Df(this,a.call(this));e._setConversation(c),e._peerConnection=e._createPeerConnection(d),e._call=Zf(),e._promises={};var f=new xd(function(a){e._promises.resolveStreamReady=a}),g=new xd(function(a){e._promises.resolveAccept=a});return xd.all([f,g]).then(function(a){var b=bc(a,1),c=b[0];e._call.can("connect")&&(e._call.connect(),e.emit("connect",c))}),e}return Qf(b,a),b.prototype.close=function(){var a=this;return xd.resolve().then(function(){a._call.close(),a._destroyPeerConnection(),a._peerConnection.close(),a._destroy()})},b.prototype._handleCloseEvent=function(){this._call.can("close")&&(this.close(),this.emit("close"))},b.prototype._setConversation=function(a){this._conversation&&this._conversation.off("message"),a&&(this._conversation=a,a.on("message",this._handleMessage.bind(this)))},b.prototype._destroy=function(){this._conversation.off("message")},b.prototype._createPeerConnection=function(a){var b=new RTCPeerConnection(a);return b.onicecandidate=this._handleICECandidateEvent.bind(this),b.onaddstream=this._handleAddStreamEvent.bind(this),b.onnremovestream=this._handleRemoveStreamEvent.bind(this),b.oniceconnectionstatechange=this._handleICEConnectionStateChangeEvent.bind(this),b.onsignalingstatechange=this._handleSignalingStateChangeEvent.bind(this),b},b.prototype._destroyPeerConnection=function(){var a=this._peerConnection;delete a.onaddstream,delete a.onremovestream,delete a.onnicecandidate,delete a.oniceconnectionstatechange,delete a.onsignalingstatechange},b.prototype._handleMessage=function(a){return a instanceof lg?this._handleAnswer(a):a instanceof ng?this._handleRefusal():a instanceof og?this._handleCancelation():a instanceof mg&&this._handleICECandidate(a)},b.prototype._handleICECandidate=function(a){var b=new RTCIceCandidate(a.payload);this._peerConnection&&this._peerConnection.addIceCandidate(b).catch(console.error.bind(console))},b.prototype._handleICECandidateEvent=function(a){return!(!a.candidate||!this._conversation)&&this._conversation.send(new mg(a.candidate)).catch(console.error.bind(console))},b.prototype._handleAddStreamEvent=function(a){this._promises.resolveStreamReady(a.stream)},b.prototype._handleRemoveStreamEvent=function(){this._handleCloseEvent()},b.prototype._handleICEConnectionStateChangeEvent=function(){switch(this._peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this._handleCloseEvent()}},b.prototype._handleSignalingStateChangeEvent=function(){switch(this._peerConnection.signalingState){case"closed":this._handleCloseEvent()}},b.prototype._handleAnswer=function(){throw new Error("not implemented")},b.prototype._handleRefusal=function(){throw new Error("not implemented")},b.prototype._handleCancelation=function(){throw new Error("not implemented")},Xf(b,[{key:"state",get:function(){return this._call.current}}]),b}(Rf),qg=function(a){function b(c,d,e){Od(this,b);var f=Df(this,a.call(this,d,e));return f.to=c,f}return Qf(b,a),b.prototype._handleAnswer=function(a){var b=new RTCSessionDescription(a.payload);this._peerConnection.setRemoteDescription(b),this._promises.resolveAccept()},b.prototype._handleRefusal=function(){this._destroyPeerConnection(),this._call.refuse(),this.emit("refuse"),this._destroy()},b.prototype.cancel=function(){var a=this;return this._call.cancel(),this._conversation.send(new og).then(function(){return a._destroy()})},b.prototype.close=function(){return this._call.can("cancel")?this.cancel():a.prototype.close.call(this)},b}(pg),rg=function(a){function b(c,d,e){Od(this,b);var f=Df(this,a.call(this,d,e));f.from=c.from;var g=new RTCSessionDescription(c.payload);return f._handleOfferPromise=f._peerConnection.setRemoteDescription(g),f}return Qf(b,a),b.prototype.accept=function(a){var b=this;if(!a)throw new TypeError("a MediaStream instance is required to accept a call");return this._handleOfferPromise.then(function(){return b._peerConnection.addStream(a)}).then(function(){return b._peerConnection.createAnswer()}).then(function(a){return b._peerConnection.setLocalDescription(a)}).then(function(){return b._conversation.send(new lg(b._peerConnection.localDescription))}).then(function(){return b._promises.resolveAccept()})},b.prototype.refuse=function(){var a=this;return this._conversation.send(new ng).then(function(){a._call.refuse(),a._destroy()})},b.prototype._handleCancelation=function(){this._call.cancel(),this.emit("cancel"),this._destroy()},b}(pg),sg=(jg=b.messageType(-101))(kg=function(a){function b(){return Od(this,b),Df(this,a.apply(this,arguments))}return Qf(b,a),b}(ag))||kg,tg={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stun.stunprotocol.org:3478","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org"]}]},ug=function(a){function b(c,d){if(Od(this,b),"string"!=typeof c)throw new TypeError("id is not a string");var e=Df(this,a.call(this));return e.id=c,e.options=Md({RTCConfiguration:tg},d),e}return Qf(b,a),b.prototype._open=function(a,b){var c=this;return a.createIMClient(this.id,b,"webrtc").then(function(a){return c._imClient=a,c.id=a.id,a.on("message",function(a,b){return a instanceof sg&&c._handleOffer(a,b)}),a.on("conflict",function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c.emit.apply(c,["conflict"].concat(b))}),c})},b.prototype.close=function(){return this._imClient.close()},b.prototype.call=function(a,b){var c=this;if("string"!=typeof a)throw new TypeError("target id is not a string");if(!b)throw new TypeError("a MediaStream instance is required to make a call");return this._imClient.ping([a]).then(function(d){if(!d.length)throw new Error("Call failed as "+a+" is not online");var e=new qg(a,null,c.options.RTCConfiguration),f=new xd(function(a){e._peerConnection.onnegotiationneeded=a});return e._peerConnection.addStream(b),f.then(function(){return xd.all([c._imClient.createConversation({members:[a],unique:!0}),e._peerConnection.createOffer().then(function(a){e._peerConnection.setLocalDescription(a)})])}).then(function(a){var b=bc(a,1),c=b[0];return e._setConversation(c),c.send(new sg(e._peerConnection.localDescription))}).then(function(){return e})})},b.prototype._handleOffer=function(a,b){var c=new rg(a,b,this.options.RTCConfiguration);this.emit("call",c)},b}(Rf),vg=[sg,lg,mg,ng,og],wg=function(a){a.createWebRTCClient=function(b,c){return new ug(b)._open(a,c)}},xg={name:"leancloud-realtime-plugin-webrtc",messageClasses:vg,onRealtimeCreate:wg},yg=!!(window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate);a.WebRTCPlugin=xg,a.isWebRTCSupported=yg,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=webrtc.min.js.map