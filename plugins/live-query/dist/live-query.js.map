{"version":3,"file":"live-query.js","sources":["../../../node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../../../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../../../node_modules/@babel/runtime/helpers/iterableToArray.js","../../../node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../../../node_modules/@babel/runtime/helpers/nonIterableSpread.js","../../../node_modules/@babel/runtime/helpers/toConsumableArray.js","../src/realtime.js","../../../node_modules/@babel/runtime/helpers/setPrototypeOf.js","../../../node_modules/@babel/runtime/helpers/inheritsLoose.js","../src/live-query-client.js","../src/index.js"],"sourcesContent":["function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\nmodule.exports = _arrayWithoutHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nmodule.exports = _iterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nmodule.exports = _nonIterableSpread, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayWithoutHoles = require(\"./arrayWithoutHoles.js\");\nvar iterableToArray = require(\"./iterableToArray.js\");\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nvar nonIterableSpread = require(\"./nonIterableSpread.js\");\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\nmodule.exports = _toConsumableArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/* eslint-disable import/no-unresolved */\nimport {\n  Protocols as _Protocols,\n  Protocals,\n  Promise as _Promise,\n} from 'leancloud-realtime/core';\n\nconst Protocols = _Protocols || Protocals;\nif (!Protocols) {\n  throw new Error('LeanCloud Realtime SDK not installed');\n}\nexport { _Promise, Protocols };\n\nexport { EventEmitter } from 'leancloud-realtime/core';\n","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  return _setPrototypeOf(o, p);\n}\nmodule.exports = _setPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var setPrototypeOf = require(\"./setPrototypeOf.js\");\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}\nmodule.exports = _inheritsLoose, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import { Protocols, _Promise, EventEmitter } from './realtime';\n\nconst { CommandType, GenericCommand, AckCommand } = Protocols;\n\nconst warn = error => console.warn(error.message);\n\nexport default class LiveQueryClient extends EventEmitter {\n  constructor(appId, subscriptionId, connection) {\n    super();\n    this._appId = appId;\n    this.id = subscriptionId;\n    this._connection = connection;\n    this._eventemitter = new EventEmitter();\n    this._querys = new Set();\n  }\n\n  _send(cmd, ...args) {\n    return this._connection.send(\n      Object.assign(cmd, {\n        appId: this._appId,\n        installationId: this.id,\n        service: 1,\n      }),\n      ...args\n    );\n  }\n\n  _open() {\n    return this._send(\n      new GenericCommand({\n        cmd: CommandType.login,\n      })\n    );\n  }\n\n  close() {\n    const _ee = this._eventemitter;\n    _ee.emit('beforeclose');\n    return this._send(\n      new GenericCommand({\n        cmd: CommandType.logout,\n      })\n    ).then(() => _ee.emit('close'));\n  }\n\n  register(liveQuery) {\n    this._querys.add(liveQuery);\n  }\n\n  deregister(liveQuery) {\n    this._querys.delete(liveQuery);\n    setTimeout(() => {\n      if (!this._querys.size) this.close().catch(warn);\n    }, 0);\n  }\n\n  _dispatchCommand(command) {\n    if (command.cmd !== CommandType.data) {\n      this.emit('unhandledmessage', command);\n      return _Promise.resolve();\n    }\n    return this._dispatchDataCommand(command);\n  }\n\n  _dispatchDataCommand({ dataMessage: { ids, msg } }) {\n    this.emit(\n      'message',\n      msg.map(({ data }) => JSON.parse(data))\n    );\n    // send ack\n    const command = new GenericCommand({\n      cmd: CommandType.ack,\n      ackMessage: new AckCommand({\n        ids,\n      }),\n    });\n    return this._send(command, false).catch(warn);\n  }\n}\n","import { _Promise } from './realtime';\nimport LiveQueryClient from './live-query-client';\n\nconst finalize = callback => [\n  // eslint-disable-next-line no-sequences\n  value => (callback(), value),\n  error => {\n    callback();\n    throw error;\n  },\n];\n\nconst onRealtimeCreate = realtime => {\n  /* eslint-disable no-param-reassign */\n  realtime._liveQueryClients = {};\n  realtime.createLiveQueryClient = subscriptionId => {\n    if (realtime._liveQueryClients[subscriptionId] !== undefined) {\n      return _Promise.resolve(realtime._liveQueryClients[subscriptionId]);\n    }\n    const promise = realtime\n      ._open()\n      .then(connection => {\n        const client = new LiveQueryClient(\n          realtime._options.appId,\n          subscriptionId,\n          connection\n        );\n        connection.on('reconnect', () =>\n          client\n            ._open()\n            .then(\n              () => client.emit('reconnect'),\n              error => client.emit('reconnecterror', error)\n            )\n        );\n        client._eventemitter.on(\n          'beforeclose',\n          () => {\n            delete realtime._liveQueryClients[client.id];\n          },\n          realtime\n        );\n        client._eventemitter.on(\n          'close',\n          () => {\n            realtime._deregister(client);\n          },\n          realtime\n        );\n        return client._open().then(() => {\n          realtime._liveQueryClients[client.id] = client;\n          realtime._register(client);\n          return client;\n        });\n      })\n      .then(\n        ...finalize(() => {\n          if (realtime._deregisterPending) realtime._deregisterPending(promise);\n        })\n      );\n    realtime._liveQueryClients[subscriptionId] = promise;\n    if (realtime._registerPending) realtime._registerPending(promise);\n    return promise;\n  };\n  /* eslint-enable no-param-reassign */\n};\n\nconst beforeCommandDispatch = (command, realtime) => {\n  const isLiveQueryCommand = command.installationId && command.service === 1;\n  if (!isLiveQueryCommand) return true;\n  const targetClient = realtime._liveQueryClients[command.installationId];\n  if (targetClient) {\n    targetClient._dispatchCommand(command).catch(error => console.warn(error));\n  } else {\n    console.warn(\n      'Unexpected message received without any live client match: %O',\n      command\n    );\n  }\n  return false;\n};\n\n// eslint-disable-next-line import/prefer-default-export\nexport const LiveQueryPlugin = {\n  name: 'leancloud-realtime-plugin-live-query',\n  onRealtimeCreate,\n  beforeCommandDispatch,\n};\n"],"names":["Protocols","_Protocols","Protocals","Error","CommandType","GenericCommand","AckCommand","warn","error","console","message","LiveQueryClient","_EventEmitter","_inheritsLoose","appId","subscriptionId","connection","_this","call","_appId","id","_connection","_eventemitter","EventEmitter","_querys","Set","_proto","prototype","_send","cmd","_this$_connection","_len","arguments","length","args","Array","_key","send","apply","Object","assign","installationId","service","concat","_open","login","close","_ee","emit","logout","then","register","liveQuery","add","deregister","_this2","setTimeout","size","_dispatchCommand","command","data","_Promise","resolve","_dispatchDataCommand","_ref","_ref$dataMessage","dataMessage","ids","msg","map","_ref2","JSON","parse","ack","ackMessage","finalize","callback","value","onRealtimeCreate","realtime","_liveQueryClients","createLiveQueryClient","_realtime$_open$then","undefined","promise","client","_options","on","_deregister","_register","_toConsumableArray","_deregisterPending","_registerPending","beforeCommandDispatch","isLiveQueryCommand","targetClient","LiveQueryPlugin","name"],"mappings":"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"}